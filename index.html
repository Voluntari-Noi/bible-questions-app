<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" type="image/png" href="images/logo-va-100.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css" />

    <script src="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin="anonymous" />

    <title>Întrebări Biblice - Pentru Cer</title>
  </head>
  <body>
    <div class="container">
      <div class="row row-header">
        <div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <img src="./images/logo-va-100.png" class="logo" />
          <h3 class="text-center">Întrebări biblice</h3>
        </div>
      </div>

      <div class="row row-board">
        <div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <div id="exercise-container">
            <div class="row">
              <div class="col">
                <div class="question">
                  <p class="info-text">
                    Fiecare întrebare este urmată de patru variante de răspuns, dintre care doar una este corectă.
                  </p>
                  <p id="question-text"></p>
                  <div class="list-group" id="list-tab" role="tablist">
                    <a class="answer answer_a list-group-item list-group-item-action" data-bs-toggle="list" href="#" role="tab" aria-controls="A"></a>
                    <a class="answer answer_b list-group-item list-group-item-action" data-bs-toggle="list" href="#" role="tab" aria-controls="B"></a>
                    <a class="answer answer_c list-group-item list-group-item-action" data-bs-toggle="list" href="#" role="tab" aria-controls="C"></a>
                    <a class="answer answer_d list-group-item list-group-item-action" data-bs-toggle="list" href="#" role="tab" aria-controls="D"></a>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col">
                <div class="app-controls">
                  <button type="button" class="btn btn-outline-secondary" id="reload-question">
                    RĂSPUNDE MAI TÂRZIU
                  </button>
                  <button type="button" class="btn btn-outline-primary float-right" id="submit-answer">
                    TRIMITE RĂSPUNSUL
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row row-footer">
        <div class="col col-lg-12 col-md-12 col-sm-12 col-xs-12">
          <p class="text-center">Aplicație dezvoltată de echipa de voluntari <a href="https://www.pentrucer.net">Pentru Cer</a></p>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"
      integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <script src="https://pentrucer.net/aplicatii/intrebari-biblice/admin/get_token_script.php"></script>
    <!--<script src="https://appboxstudios.com/software/intrebari-biblice/admin/get_token_script.php"></script>-->
    <script type="text/javascript">
      //var baseUrl = 'https://appboxstudios.com/software/intrebari-biblice/admin'
      var baseUrl = 'https://pentrucer.net/aplicatii/intrebari-biblice/admin';
      window.answered_ids = [];

      $('document').ready(function() {
        window.current_question = 0;
        window.get_questions_url = baseUrl + '/get_questions.php?token=' + window.token;
        window.questions = [];

        function get_questions_list_and_start() {
          var extra_args = '&limit=3&exclude_ids=' + encodeURI(window.answered_ids.join(','));
          var jqxhr = $.getJSON(
            window.get_questions_url + extra_args,
            function(data) {
              console.log(data);
              if (data.status == 0) {
                $('div.questions-list').html('');
                window.token = data.next_token;
                window.questions = data.response;
                // var question = questions[item];
                // var question_id = question['id'];
                // var text = question['question_text'];
                // var correct = question['correct_answer'];
                // var incorrect_1 = question['incorrect_answer_1'];
                // var incorrect_2 = question['incorrect_answer_2'];
                // var incorrect_3 = question['incorrect_answer_3'];
                // var source = question['source'];

                if (window.questions.length > 0) {
                  next_question();
                }
              }
            },
          )
          .fail(function(data) {
            var error = data.responseJSON.error;
            console.log('Eroare la deschiderea întrebărilor.', error);
          })
          .always(function(data) {
            console.log('complete');
          })
        }

        function next_question() {
          // choose next question
          var question = window.questions[window.current_question];
          console.log(
            'More questions?',
            window.questions.length,
            window.current_question,
            window.answered_ids.length,
          );

          if (window.questions.length <= window.current_question) {
            window.current_question = 0;
            get_questions_list_and_start();
            return
          }

          window.current_question += 1;
          window.answered_ids.push(question.id);
          console.log(question.id);
          $('p#question-text').text(question.question_text);
          $('a.answer_a').text(question.correct_answer);
          $('a.answer_b').text(question.incorrect_answer_1);
          $('a.answer_c').text(question.incorrect_answer_2);
          $('a.answer_d').text(question.incorrect_answer_3);
          $('a.answer_a').addClass('correct');
        }

        $('button#submit-answer').on('click', function() {
          var selected_button = $('a.active');
          var is_correct = $(selected_button[0]).hasClass('correct');
          if (is_correct) {
            Swal.fire('🎉 Felicitări! ', 'Ai răspuns corect.');
            next_question();
          } else {
            Swal.fire('Ai greșit!❌', 'Încearcă din nou.');
          }
        });

        $('button#reload-question').on('click', function() {
          next_question();
        });

        function start_game() {
          get_questions_list_and_start();
        }

        start_game();
      });
    </script>
  </body>
</html>
